# Deployment Summary - Quick Reference

## ğŸš€ What Was Set Up

### Files Created
- âœ… [fly.toml](fly.toml) - Fly.io backend configuration
- âœ… [netlify.toml](netlify.toml) - Netlify frontend configuration
- âœ… [.github/workflows/deploy-backend.yml](.github/workflows/deploy-backend.yml) - Auto-deploy workflow
- âœ… [DEPLOYMENT.md](DEPLOYMENT.md) - Full deployment guide (detailed)
- âœ… [DEPLOY_QUICKSTART.md](DEPLOY_QUICKSTART.md) - Quick deploy guide (5 minutes)
- âœ… [scripts/deploy.sh](scripts/deploy.sh) - Deployment helper script
- âœ… [.flyignore](.flyignore) - Optimize Fly.io uploads
- âœ… [backend/.dockerignore](backend/.dockerignore) - Optimize Docker builds
- âœ… [frontend/.dockerignore](frontend/.dockerignore) - Optimize frontend builds

### Code Changes
- âœ… Added health check endpoint: [backend/lib/backend_web/router.ex](backend/lib/backend_web/router.ex:23)
- âœ… Added health check handler: [backend/lib/backend_web/controllers/page_controller.ex](backend/lib/backend_web/controllers/page_controller.ex:13)
- âœ… Updated backend Dockerfile for Fly.io
- âœ… Added Elm build script to package.json

---

## ğŸ“‹ Next Steps (In Order)

### 1. Deploy Backend (2 minutes)

```bash
# Install Fly.io CLI if needed
curl -L https://fly.io/install.sh | sh

# Login
flyctl auth login

# Deploy using helper script
./scripts/deploy.sh setup    # First time only
./scripts/deploy.sh backend  # Deploy
```

Or manually:
```bash
flyctl launch --name pacemate-backend --region sjc --no-deploy
flyctl secrets set SECRET_KEY_BASE="$(mix phx.gen.secret)"
flyctl secrets set PHX_HOST="pacemate-backend.fly.dev"
flyctl deploy
```

**Result:** Backend live at `https://pacemate-backend.fly.dev`

### 2. Deploy Frontend (3 minutes)

**Option A: Netlify UI (Recommended)**
1. Go to https://app.netlify.com/
2. "Add new site" â†’ "Import from Git" â†’ Select repo
3. Configure:
   - Base directory: `frontend`
   - Build command: `npm install && npm run build:elm`
   - Publish directory: `frontend`
4. Add env var: `BACKEND_URL=wss://pacemate-backend.fly.dev`
5. Deploy!

**Option B: Netlify CLI**
```bash
npm install -g netlify-cli
netlify login
./scripts/deploy.sh frontend
netlify deploy --prod --dir=frontend
```

**Result:** Frontend live at `https://your-site.netlify.app`

### 3. Update Frontend WebSocket URL

Find where WebSocket connects and update:

```javascript
// frontend/src/index.js or similar
const socket = new WebSocket("wss://pacemate-backend.fly.dev/socket")
```

Commit and push - Netlify auto-deploys!

### 4. Enable GitHub Actions Auto-Deploy

```bash
# Get Fly API token
flyctl auth token

# Add to GitHub:
# Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New secret
# Name: FLY_API_TOKEN
# Value: [paste token]
```

Now pushing to `main` auto-deploys backend! âœ¨

---

## ğŸ” Verify Deployment

### Backend Health Check
```bash
curl https://pacemate-backend.fly.dev/api/health
# Expected: {"status":"ok","service":"pacemate-backend"}
```

### Frontend
Open: `https://your-site.netlify.app`

### WebSocket
Open browser console on frontend, should see:
```
WebSocket connection established
```

---

## ğŸ“Š Commands Reference

### Deployment
```bash
./scripts/deploy.sh setup       # Initial Fly.io setup
./scripts/deploy.sh backend     # Deploy backend
./scripts/deploy.sh frontend    # Build frontend
./scripts/deploy.sh all         # Deploy everything
./scripts/deploy.sh status      # Check status
./scripts/deploy.sh logs        # View backend logs
```

### Fly.io
```bash
flyctl status                   # Check app status
flyctl logs                     # View logs
flyctl dashboard                # Open web dashboard
flyctl ssh console              # SSH into VM
flyctl secrets list             # List secrets
flyctl secrets set KEY=value    # Set secret
flyctl scale count 2            # Scale to 2 VMs
flyctl regions add lhr          # Add London region
```

### Netlify
```bash
netlify status                  # Check deployment
netlify logs                    # View logs
netlify deploy --prod           # Manual deploy
netlify open                    # Open dashboard
```

---

## ğŸ’° Costs

**Free Tier (Sufficient for PaceMate):**
- Fly.io: 3 shared VMs (256MB) + 160GB bandwidth
- Netlify: 100GB bandwidth + 300 build minutes
- **Total: $0/month** âœ…

---

## ğŸ†˜ Troubleshooting

### Backend not responding
```bash
flyctl logs
flyctl status
curl https://pacemate-backend.fly.dev/api/health
```

### Frontend not connecting
- Check browser console
- Verify WebSocket URL uses `wss://` (not `ws://`)
- Check backend logs: `flyctl logs`

### Build failing
```bash
# Test locally first
cd backend && mix release
cd frontend && npm run build:elm
```

---

## ğŸ“š Documentation

- **Quick Start:** [DEPLOY_QUICKSTART.md](DEPLOY_QUICKSTART.md) - Deploy in 5 minutes
- **Full Guide:** [DEPLOYMENT.md](DEPLOYMENT.md) - Detailed instructions, scaling, monitoring
- **Main README:** [README.md](README.md) - Project overview

---

## ğŸ¯ Architecture

```
User Browser
    â†“
Netlify CDN (Frontend) â†â†’ WSS â†â†’ Fly.io (Backend)
    â†“                              â†“
Static Assets                 WebSocket Server
                                   â†“
                          Ollama AI (Optional)
```

**Key Features:**
- âœ… Auto-scaling (scale to zero on free tier)
- âœ… HTTPS/WSS automatic
- âœ… Global CDN
- âœ… WebSocket support
- âœ… Health checks
- âœ… Auto-deploy on push

---

## âœ… Deployment Checklist

- [ ] Fly.io CLI installed
- [ ] Backend deployed and health check passing
- [ ] Frontend deployed to Netlify
- [ ] WebSocket URL updated in frontend
- [ ] GitHub Actions configured (FLY_API_TOKEN)
- [ ] Tested production deployment
- [ ] Monitoring set up (Fly.io dashboard)

---

**Need Help?**
- See [DEPLOYMENT.md](DEPLOYMENT.md) for detailed guide
- See [DEPLOY_QUICKSTART.md](DEPLOY_QUICKSTART.md) for quick commands
- Run `./scripts/deploy.sh help` for script usage

---

*Configuration complete! Ready to deploy.* ğŸ‰
